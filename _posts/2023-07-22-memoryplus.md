---
layout: post
title: "WEEK2 힙과 스택"
categories: Challenge-Week2
---

## 월요일에 학습 스택과 관련해 토론을 하면서..

메모리는 우리가 코드를 작성하고 동작을 하면 정해진 규칙에 의해 자동적으로 할당된다고 생각해서 그냥 그 메모리 공부하면 나오는 그림들을 just 받아들이기만 했다. 근데 힙과 스택에 관한 얘기가 나오다 보니 나도 궁금증이 생겼다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f1147529-fdd6-4e5b-8d75-e3e480ee708a/Untitled.png)

(그림 출처 - 정제님 벨로그!)

처음 생각했을 때는 힙은 동적인 공간(new 생성자를 활용해 만들어지는 객체들이 들어가는)이고, 스택은 고정된 공간(주소값, 일시적인 변수들을 미리 저장해놓는)이라고 생각했다. 그래서 힙이 런타임에 결정, 스택이 컴파일 시간에 결정된다는 말을 자연스럽게 받아들인 거고.

### 제시된 의견

근데 제시됐던 의견이 `Stack Overflow`, `Heap Overflow` 라는 에러도 발생하는데, 이는 스택의 공간이 고정되면 발생하는게 맞나? 라는 말이었다. 왜냐면 이미 컴파일 시에 스택에 들어갈 변수들을 고려하여 크기를 결정했으니 생각해보면 에러가 날 수 없기 때문이다.

### 결론

(이건 지금 찾아본 얘기) 스택 오버플로우는 내가 생각한 상황에서 발생하는 에러라기 보다는 스택 포인터가 스택의 경계를 넘어설 때, 즉 호출 스택이 제한된 양의 주소 공간 이상을 사용하려고 할 때 발생한다고 한다.

또 스택과 힙은 중간에 여분의 공간을 두고 하나의 큰 공간을 공유하는데, 이때 각자 영역을 계속 넓혀가다가 서로의 영역을 침범할 때도 overflow가 발생한다고 한다.

아 그리고 힙 영역은 가변적으로 크기를 늘려줄 수 있다고 한다!

**∴ 우리가 통상적으로 알고 있는 내용이 일반적으로는 맞다. 스택은 컴파일 시 공간이 결정되고, 힙은 런타임시 동적으로 결정된다.**

### 추가적으로

멀티 스레드 환경에서의 얘기도 나왔다.

멀티 스레드에서는 상황에 따라 여러 스레드가 여러개의 스택을 생성해 가변적으로 변화하고(컴파일 결정 X) , 힙 공간은 동적으로 공간을 늘려줄(resize) 수 있어 런타임 시에 결정된다.

## 참고

https://ko.wikipedia.org/wiki/%EC%8A%A4%ED%83%9D_%EC%98%A4%EB%B2%84%ED%94%8C%EB%A1%9C
https://velog.io/@code-l/%EB%A9%80%ED%8B%B0%EC%8A%A4%EB%A0%88%EB%93%9C%EC%97%90%EC%84%9C-%ED%9E%99%EA%B3%BC-%EC%8A%A4%EB%A0%88%EB%93%9C-%EA%B3%B5%EA%B0%84
https://velog.io/@sp1rit/%EC%8A%A4%ED%83%9DStack%EA%B3%BC-%ED%9E%99Heap
